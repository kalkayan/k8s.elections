{% extends 'layouts/app.html' %}

{% block header %}
<h1>{% block title %}{{ election['name'] }}{% endblock %}</h1>
{% endblock %}

{% block breadcrums %}
<a href="{{ url_for('elections') }}" class="breadcrums">elections</a>
<a href="{{ url_for('elections_single', eid=election['key']) }}"
    class="breadcrums breadcrums-active">{{ election['name'] }}</a>
{% endblock %}

{% block content %}


<div class="dashboard">
    <div class="space--md pb-1rem">
        <div class="border--bottom pb-10px mb-1rem">
            <h1 class="title title-has-subtitle pb-0">
                {{ election['name'] }}
                <small class="badge badge-{{  election['status'] }} ">{{ election['status'] }}</small>
                {% if g.user['login'] in voters['eligible_voters'] %}
                <small class="badge badge-blue ">eligible</small>
                {% else %}
                <small class="badge badge-blue">Not eligible</small>
                {% endif %}
            </h1>
            <span>{{ election['organization'] }}</span>
        </div>
        <div class="description">
            {{ election['description'] | safe }}
        </div>
        <p class="disclaimer">
            The poll ends <b>{{ election['end_datetime'] }}</b>.
            The poll is supervised by
            <b>
                {% for eo in election['election_officers'] %}
                <a class="text-dark" target="__blank" href="https://github.com/{{ eo }}">
                    {{ eo + ', ' if election['election_officers']|length > loop.index else eo + '.' }}
                </a>
                {% endfor %}
            </b>
            Contact the poll supervisor if you need help.
        </p>
    </div>
    <div class="space--md pt-0">
        <h1 class="subtitle border--bottom">
            Candidates
        </h1>
        <div>
            {% for candidate in candidates %}

            <div class="row border--bottom">
                <div class="col-9">
                    <a href="{{ url_for('elections_candidate', eid=election['key'], cid=candidate['key']) }}">
                        <span class="row-title">
                            {{ candidate['name'] }}
                        </span>
                    </a>
                </div>
                <div class="col-3 text--right">
                    <a class="text-dark"
                        href="{{ url_for('elections_candidate', eid=election['key'], cid=candidate['key']) }}">view
                        profile</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="space--md pt-0">
        {% if g.user['login'] in election['election_officers']  %}
        <a href="{{ url_for('elections_admin', eid=election['key'])}}" class="btn btn-grey">Admin</a>
        {% endif %}
        {% if election['status'] == 'running' and g.user['login'] in voters['eligible_voters']  %}
            <a href="{{ url_for('elections_voting_page', eid=election['key'])}}" class="btn btn-grey">vote</a>
        {% elif election['status'] == 'completed' %}
            <a href="{{ url_for('elections_results', eid=election['key'])}}" class="btn btn-grey">Results</a>
        {% endif %}
    </div>
</div>

{% endblock %}
